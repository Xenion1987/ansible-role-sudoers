---
- name: "TEST | ROLE | sudoers"
  hosts: localhost
  become: true
  vars:
    sudoers_install_sudo: true
    sudoers_manage_group_files: true
    sudoers_groups:
      - name: sudoers_group_file
        group: sudoers_mygroupname
        commands:
          - ALL
        nopassword: false
        state: present

    sudoers_manage_user_files: true
    sudoers_users:
      - name: sudoers_user_file
        user: john.doe
        commands:
          - ALL
        nopassword: false
        state: present
  roles:
    - ../sudoers

  tasks:
    - name: DEBUG | sudoers_group_file
      changed_when: false
      ansible.builtin.shell:
        executable: /bin/bash
        cmd: |
          EXPECTED='%sudoers_mygroupname ALL=NOPASSWD: ALL'
          if [[ ! $(cat /etc/sudoers.d/sudoers_group_file) == "${EXPECTED}" ]]; then
            exit 1
          fi
    - name: DEBUG | sudoers_user_file
      changed_when: false
      ansible.builtin.shell:
        executable: /bin/bash
        cmd: |
          EXPECTED='john.doe ALL=NOPASSWD: ALL'
          if [[ ! $(cat /etc/sudoers.d/sudoers_user_file) == "${EXPECTED}" ]]; then
            exit 1
          fi
